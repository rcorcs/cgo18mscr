\begin{abstract}

    Iterative compilation can dramatically improve the performance of a program by searching for the best optimization. However, it relies
    upon repeatedly evaluating optimizations on predefined representative inputs. If the developers fail to guess what is a representative
    input or usage patterns change over time, then the wrong optimizations may be selected. Searching the optimization space with actual
    user inputs, during deployment, has previously seemed infeasible. Program side effects and difficulties capturing the system state mean
    that any given input can only be executed once, online. Existing performance metrics cannot be used to compare optimizations evaluated
    under different inputs. Unless we devise a new metric that can be used in such a way, we will be unable to apply iterative compilation
    online with real live inputs, users will not have properly optimized programs, and performance will suffer. 
    
    We present metrics and techniques which, for the first time, enable the use of true {\em online iterative compilation}. We compare
    optimizations by a new work efficiency metric, which requires only a single execution with any one input. We develop an instrumented,
    low overhead, mechanism for gathering the required data, using optimal probe placement in the source code. We show that overhead can be
    further reduced by removing high-cost probes whose absence introduces only small errors to the work metric, without significantly
    affecting the outcome of the iterative compilation. We give two variants for probe removal optimization: the first offers strong
    guarantees about the maximum possible error, while the second targets the average whole program error.

    Our online iterative compilation method yields programs that get 60\% of the speedup achievable by an oracle that depends on reusing
    inputs, something that cannot be done online. Through probe removal we bring the instrumentation overhead down to only 5\% on average,
    making our approach suitable for real-world scenarios. %We show practical online iterative compilation for the first time, optimizing
    %programs according to the range of inputs users actually present.
\end{abstract}
